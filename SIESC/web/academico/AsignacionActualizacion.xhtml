<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:composition template="./templateAcademico.xhtml">
        <ui:define name="content">

            <h:form id="formAsigGrupo">

                <div class="card" style="padding:20px; margin:auto; max-width:100%;">
                    <h2 style="text-align:center; color:#0d47a1;">ASIGNACIÓN Y ACTUALIZACIÓN<br/>DE DOCENTES A GRUPOS</h2>

                    <p:growl id="growlAsignacion" showDetail="true" sticky="false" life="4000"/>
                    <!-- PANEL PRINCIPAL -->
                    <p:panel header="DATOS PARA LA ASIGNACIÓN DE DOCENTES" styleClass="panel-azul">
                        <p:panelGrid columns="2" layout="grid" styleClass="ui-fluid sin-borde">


                            <p:outputLabel value="Departamento:" />
                            <p:selectOneMenu value="#{asignacionMGBean.departamentoSeleccionado}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioDepartamento}" update="formAsigGrupo tablaDatos growlAsignacion"/>
                                <f:selectItem itemLabel="Seleccione un departamento" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{asignacionMGBean.listaDepartamentos}" var="dep"
                                               itemLabel="#{dep.descripcionArea} (#{dep.claveArea})" itemValue="#{dep.claveArea}" />
                            </p:selectOneMenu>

                            <p:outputLabel value="Carrera:" />
                            <p:selectOneMenu value="#{asignacionMGBean.carreraSeleccionada}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioCarrera}" update="tablaDatos growlAsignacion"/>
                                <f:selectItem itemLabel="Selecciones una carrera" itemValue="" noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{asignacionMGBean.listaPermisos}" 
                                    var="listaPermiso"
                                    itemLabel="#{listaPermiso.reticula.nombreCarrera} (#{listaPermiso.reticula.claveOficial})"
                                    itemValue="#{listaPermiso.reticula.reticula}" />
                            </p:selectOneMenu>


                            <p:outputLabel value="Periodo:" />

                            <p:selectOneMenu id="periodo" 
                                             value="#{asignacionMGBean.periodoSeleccionado}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioSemestre}" update="growlAsignacion tablaDatos" />
                                <f:selectItem itemLabel="Seleccione el Periodo" itemValue="" />
                                <f:selectItems 
                                    value="#{asignacionMGBean.listaPeriodos}" 
                                    var="p" 
                                    itemLabel="#{p.identificacionCorta}" 
                                    itemValue="#{p.periodo}" />
                            </p:selectOneMenu>


                            <p:outputLabel value="Semestre:" />
                            <p:selectOneMenu id="semestre" 
                                             value="#{asignacionMGBean.semestreSeleccionado}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioSemestre}" update="tablaDatos growlAsignacion" />
                                <f:selectItem itemLabel="Selecciona un semestre" itemValue="" />
                                <f:selectItems value="#{asignacionMGBean.semestres}" var="s"
                                               itemLabel="#{s}" itemValue="#{s}" />
                            </p:selectOneMenu>







                        </p:panelGrid>
                    </p:panel>





                </div>

                <div class="card" style="padding:20px; margin:auto; max-width:100%;">



                    <h3 style="text-align:center; margin-top:25px;">GRUPOS</h3>
                    <p:dataTable value="#{asignacionMGBean.listaHorarioCrear}" 
                                 var="h"
                                 styleClass="tabla-horarios"
                                 style="width:100%;"
                                 id="tablaDatos"
                                 selectionMode="single"
                                 selection="#{asignacionMGBean.horarioCrearSeleccionado}"
                                 rowKey="#{h.id}" >
                        <p:ajax event="rowSelect"
                                listener="#{asignacionMGBean.filaSeleccionada}"
                                process="@this"
                                update=":formAsigGrupo:dlgMaestros 
                                :formAsigGrupo:growlAsignacion 
                                :formAsigGrupo:tablaHorariosMaestro"
                                oncomplete="PF('dlgMaestros').show();" />
                        <!-- Clave -->
                        <p:column headerText="Clave" style="width:6%;">
                            #{h.materia}
                        </p:column>
                        <p:column headerText="ID">
                            #{h.id}
                        </p:column>

                        <!-- Asignatura -->
                        <p:column headerText="Asignatura" style="width:28%; line-height: 1.2;">
                            <div class="asignatura-box linea-divisora">
                                <span class="materia">#{h.asignatura}</span>
                                <div class="linea"></div>
                                <span class="maestro">#{h.docente}</span>
                            </div>
                        </p:column>

                        <!-- Grupo -->
                        <p:column headerText="Grupo" style="width:6%;">
                            #{h.grupo}
                        </p:column>

                        <!-- Días con ancho igual -->
                        <p:column headerText="Lunes" style="width:8%;">#{h.lunes}</p:column>
                        <p:column headerText="Martes" style="width:8%;">#{h.martes}</p:column>
                        <p:column headerText="Miércoles" style="width:8%;">#{h.miercoles}</p:column>
                        <p:column headerText="Jueves" style="width:8%;">#{h.jueves}</p:column>
                        <p:column headerText="Viernes" style="width:8%;">#{h.viernes}</p:column>
                        <p:column headerText="Sábado" style="width:8%;">#{h.sabado}</p:column>

                        <!-- Botón eliminar -->
                        <p:column style="text-align:center; width:3%;">
                            <p:commandButton 
                                icon="pi pi-trash"
                                styleClass="btn-basura"
                                actionListener="#{asignacionMGBean.accionEliminar(h)}"
                                process="@this"
                                update=":formAsigGrupo:tablaDatos :formAsigGrupo:growlAsignacion"
                                onclick="event.stopPropagation();">
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>



                </div>
                <p:dialog id="dlgMaestros"  
                          widgetVar="dlgMaestros"
                          header="Asignar Maestro"
                          modal="true"
                          resizable="false"
                          width="1250">

                    <!-- Horario seleccionado -->
                    <p:dataTable value="#{asignacionMGBean.listaHorarioSeleccionado}" 
                                 var="h" 
                                 styleClass="tabla-horarios"
                                 style="width:100%; margin-bottom:15px;"
                                 rowKey="#{h.id}">

                        <p:column headerText="Clave" style="width:6%;">#{h.materia}</p:column>

                        <p:column headerText="Asignatura" style="width:28%; line-height:1.2;">
                            <div class="asignatura-box linea-divisora">
                                <span class="materia">#{h.asignatura}</span>
                                <div class="linea"></div>
                                <span class="maestro">#{h.docente}</span>
                            </div>
                        </p:column>

                        <p:column headerText="Grupo" style="width:6%;">#{h.grupo}</p:column>

                        <p:column headerText="Lunes" style="width:8%;">#{h.lunes}</p:column>
                        <p:column headerText="Martes" style="width:8%;">#{h.martes}</p:column>
                        <p:column headerText="Miércoles" style="width:8%;">#{h.miercoles}</p:column>
                        <p:column headerText="Jueves" style="width:8%;">#{h.jueves}</p:column>
                        <p:column headerText="Viernes" style="width:8%;">#{h.viernes}</p:column>
                        <p:column headerText="Sábado" style="width:8%;">#{h.sabado}</p:column>

                    </p:dataTable>


                    <!-- Selección de maestro -->
                    <p:selectOneMenu value="#{asignacionMGBean.docenteRFC}" 
                                     filter="true" filterMatchMode="contains"
                                     style="width:100%; margin-bottom:15px;">
                        <p:ajax listener="#{asignacionMGBean.verHorarioMaestro}" update=":formAsigGrupo:tablaDatos :formAsigGrupo:tablaHorariosMaestro"/>
                        <f:selectItem itemLabel="SELECCIONE UN MAESTRO" itemValue="" />
                        <f:selectItems value="#{asignacionMGBean.listaDocentes}"
                                       var="pr" 
                                       itemLabel="#{pr.rfc} / #{pr.nombreEmpleado} #{pr.apellidoPaterno} #{pr.apellidoMaterno}" 
                                       itemValue="#{pr.rfc}" />
                    </p:selectOneMenu>

                    <!-- Botón Asignar -->
                    <div style="display:flex; justify-content:flex-end; margin-top:10px;">
                        <p:commandButton value="Asignar"
                                         icon="pi pi-check"
                                         styleClass="btn-asignar"
                                         actionListener="#{asignacionMGBean.guardarMaestro}"
                                         update=":formAsigGrupo:tablaDatos :formAsigGrupo:growlAsignacion"
                                         oncomplete="PF('dlgMaestros').hide();" />
                    </div>

                    <!-- Horario del maestro (se actualiza automáticamente al seleccionar uno) -->
                    <p:panel header="Horario del Maestro Seleccionado" style="margin-top:15px;">

                        <!-- CONTENEDOR CON SCROLL VERTICAL -->
                        <div style="max-height:200px; overflow-y:auto;">

                            <p:dataTable value="#{asignacionMGBean.listaHorarioCrearMaestros}"
                                         var="hm"
                                         id="tablaHorariosMaestro"
                                         styleClass="tabla-horarios"
                                         style="width:100%;"
                                         rowKey="#{hm.id}">

                                <p:column headerText="Clave" style="width:6%;">#{hm.materia}</p:column>

                                <p:column headerText="Asignatura" style="width:28%; line-height:1.2;">
                                    <div class="asignatura-box linea-divisora">
                                        <span class="materia">#{hm.asignatura}</span>
                                        <div class="linea"></div>
                                        <span class="maestro">#{hm.docente}</span>
                                    </div>
                                </p:column>

                                <p:column headerText="Grupo" style="width:6%;">#{hm.grupo}</p:column>

                                <p:column headerText="Lunes" style="width:8%;">#{hm.lunes}</p:column>
                                <p:column headerText="Martes" style="width:8%;">#{hm.martes}</p:column>
                                <p:column headerText="Miércoles" style="width:8%;">#{hm.miercoles}</p:column>
                                <p:column headerText="Jueves" style="width:8%;">#{hm.jueves}</p:column>
                                <p:column headerText="Viernes" style="width:8%;">#{hm.viernes}</p:column>
                                <p:column headerText="Sábado" style="width:8%;">#{hm.sabado}</p:column>

                            </p:dataTable>

                        </div>
                    </p:panel>





                </p:dialog>

            </h:form>








        </ui:define>





    </ui:composition>

</html>

