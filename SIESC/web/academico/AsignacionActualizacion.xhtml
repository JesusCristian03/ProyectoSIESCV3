<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:composition template="./templateAcademico.xhtml">
        <ui:define name="content">
            <f:metadata>
                <f:event type="preRenderView" listener="#{asignacionMGBean.resetearSiEsRecarga}" />
            </f:metadata>
            <h:form id="formAsigGrupo">

                <div class="card" style="padding:10px 20px; margin:auto; max-width:100%;">


                    <p:growl id="growlAsignacion" showDetail="true" sticky="false" life="4000"/>
                    <!-- PANEL PRINCIPAL -->
                    <p:panel header="ASIGNACIÓN Y ACTUALIZACIÓN DE DOCENTES A GRUPOS" styleClass="panel-azul">
                        <p:panelGrid columns="2" styleClass="ui-fluid" columnClasses="ui-g-12 ui-md-6">


                            <p:outputLabel value="DEPARTAMENTO:" style="font-weight:bold;"/>
                            <p:outputLabel value="CARRERA:" style="font-weight:bold;"/>
                            <p:selectOneMenu value="#{asignacionMGBean.departamentoSeleccionado}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioDepartamento}" update="formAsigGrupo tablaDatos growlAsignacion"/>
                                <f:selectItem itemLabel="Seleccione un departamento" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{asignacionMGBean.listaDepartamentos}" var="dep"
                                               itemLabel="#{dep.descripcionArea} (#{dep.claveArea})" itemValue="#{dep.claveArea}" />
                            </p:selectOneMenu>


                            <p:selectOneMenu value="#{asignacionMGBean.carreraSeleccionada}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioCarrera}" update="tablaDatos growlAsignacion"/>
                                <f:selectItem itemLabel="Selecciones una carrera" itemValue="" noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{asignacionMGBean.listaPermisos}" 
                                    var="listaPermiso"
                                    itemLabel="#{listaPermiso.reticula.nombreCarrera} (#{listaPermiso.reticula.claveOficial})"
                                    itemValue="#{listaPermiso.reticula.reticula}" />
                            </p:selectOneMenu>


                            <p:outputLabel value="PERIODO:" style="font-weight:bold;"/>
                            <p:outputLabel value="SEMESTRE:" style="font-weight:bold;"/>
                            <p:selectOneMenu id="periodo" 
                                             value="#{asignacionMGBean.periodoSeleccionado}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioSemestre}" update="growlAsignacion tablaDatos" />
                                <f:selectItem itemLabel="Seleccione el Periodo" itemValue="" />
                                <f:selectItems 
                                    value="#{asignacionMGBean.listaPeriodos}" 
                                    var="p" 
                                    itemLabel="#{p.identificacionCorta}" 
                                    itemValue="#{p.periodo}" />
                            </p:selectOneMenu>



                            <p:selectOneMenu id="semestre" 
                                             value="#{asignacionMGBean.semestreSeleccionado}"
                                             filter="true" 
                                             filterMatchMode="contains" >
                                <p:ajax listener="#{asignacionMGBean.cambioSemestre}" update="tablaDatos growlAsignacion" />
                                <f:selectItem itemLabel="Selecciona un semestre" itemValue="" />
                                <f:selectItems value="#{asignacionMGBean.semestres}" var="s"
                                               itemLabel="#{s}" itemValue="#{s}" />
                            </p:selectOneMenu>







                        </p:panelGrid>
                    </p:panel>





                </div>

                <div class="card" style="padding:10px 20px; margin:auto; max-width:100%;">


                    <!-- Horario del maestro (se actualiza automáticamente al seleccionar uno) -->
                    <p:panel header="GRUPOS DISPONIBLES" styleClass="panel-azul">

                        <!-- CONTENEDOR CON SCROLL VERTICAL -->
                        <div style="max-height:400px; overflow-y:auto;">
                            <p:dataTable value="#{asignacionMGBean.listaHorarioCrear}" 
                                         var="h"
                                         styleClass="tabla-horarios"
                                         style="width:100%;"
                                         id="tablaDatos"
                                         selectionMode="single"
                                         selection="#{asignacionMGBean.horarioCrearSeleccionado}"
                                         rowKey="#{h.id}" >
                                <p:ajax event="rowSelect"
                                        listener="#{asignacionMGBean.filaSeleccionada}"
                                        process="@this"
                                        update=":formAsigGrupo:dlgMaestros 
                                        :formAsigGrupo:growlAsignacion 
                                        :formAsigGrupo:tablaHorariosMaestro"
                                        oncomplete="PF('dlgMaestros').show();" />

                                <p:column headerText="ID" style="width:5%;">
                                    #{h.id}
                                </p:column>
                                <p:column headerText="CLAVE" style="width:5%;">
                                    #{h.materia}
                                </p:column>



                                <p:column headerText="ASIGNATURA" style="width:19%; line-height: 1.2;">
                                    <div class="asignatura-box linea-divisora">
                                        <span class="materia">#{h.asignatura}</span>
                                        <div class="linea"></div>
                                        <span class="maestro">#{h.docente}</span>
                                    </div>
                                </p:column>


                                <p:column headerText="GRUPO" style="width:5%;">
                                    #{h.grupo}
                                </p:column>


                                <p:column headerText="LUNES" style="width:10%; ">#{h.lunes}</p:column>
                                <p:column headerText="MARTES" style="width:10%;">#{h.martes}</p:column>
                                <p:column headerText="MIERCOLES" style="width:10%;">#{h.miercoles}</p:column>
                                <p:column headerText="JUEVES" style="width:10%;">#{h.jueves}</p:column>
                                <p:column headerText="VIERNES" style="width:10%;">#{h.viernes}</p:column>
                                <p:column headerText="SABADO" style="width:10%;">#{h.sabado}</p:column>


                                <p:column style="text-align:center; width:6%;">
                                    <p:commandButton 
                                        icon="pi pi-trash"
                                        styleClass="btn-basura"
                                        actionListener="#{asignacionMGBean.accionEliminar(h)}"
                                        process="@this"
                                        update=":formAsigGrupo:tablaDatos :formAsigGrupo:growlAsignacion"
                                        onclick="event.stopPropagation();">
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>




                        </div>
                    </p:panel>



                </div>
                <p:dialog id="dlgMaestros"  
                          widgetVar="dlgMaestros"
                          header="ASIGNAR MAESTRO"
                          modal="true"
                          resizable="false"
                          width="1250">


                    <!-- Horario del maestro (se actualiza automáticamente al seleccionar uno) -->
                    <p:panel header="HORARIO SELECCIONADO" style="margin-top:15px;">

                        <!-- CONTENEDOR CON SCROLL VERTICAL -->
                        <div style="max-height:200px; overflow-y:auto;">
                            <!-- Horario seleccionado -->
                            <p:dataTable value="#{asignacionMGBean.listaHorarioSeleccionado}" 
                                         var="h" 
                                         styleClass="tabla-horarios"
                                         style="width:100%; margin-bottom:15px;"
                                         rowKey="#{h.id}">

                                <p:column headerText="CLAVE" style="width:6%;">#{h.materia}</p:column>

                                <p:column headerText="ASIGNATURA" style="width:28%; line-height:1.2;">
                                    <div class="asignatura-box linea-divisora">
                                        <span class="materia">#{h.asignatura}</span>
                                        <div class="linea"></div>
                                        <span class="maestro">#{h.docente}</span>
                                    </div>
                                </p:column>

                                <p:column headerText="Grupo" style="width:6%;">#{h.grupo}</p:column>

                                <p:column headerText="LUNES" style="width:8%;">#{h.lunes}</p:column>
                                <p:column headerText="MARTES" style="width:8%;">#{h.martes}</p:column>
                                <p:column headerText="MIERCOLES" style="width:8%;">#{h.miercoles}</p:column>
                                <p:column headerText="JUEVES" style="width:8%;">#{h.jueves}</p:column>
                                <p:column headerText="VIERNES" style="width:8%;">#{h.viernes}</p:column>
                                <p:column headerText="SABADO" style="width:8%;">#{h.sabado}</p:column>

                            </p:dataTable>


                        </div>
                    </p:panel>


                    <!-- Selección de maestro -->
                    <p:selectOneMenu value="#{asignacionMGBean.docenteRFC}" 
                                     filter="true" filterMatchMode="contains"
                                     style="width:100%; margin-bottom:15px;">
                        <p:ajax listener="#{asignacionMGBean.verHorarioMaestro}" update=":formAsigGrupo:tablaDatos :formAsigGrupo:tablaHorariosMaestro"/>
                        <f:selectItem itemLabel="SELECCIONE UN MAESTRO" itemValue="" />
                        <f:selectItems value="#{asignacionMGBean.listaDocentes}"
                                       var="pr" 
                                       itemLabel="#{pr.rfc} / #{pr.nombreEmpleado} #{pr.apellidoPaterno} #{pr.apellidoMaterno}" 
                                       itemValue="#{pr.rfc}" />
                    </p:selectOneMenu>


                    <div style="display:flex; justify-content:flex-end; margin-top:10px;">
                        <p:commandButton value="ASIGNAR"
                                         icon="pi pi-check"
                                         styleClass="btn-asignar"
                                         actionListener="#{asignacionMGBean.guardarMaestro}"
                                         update=":formAsigGrupo:tablaDatos :formAsigGrupo:growlAsignacion"
                                         oncomplete="PF('dlgMaestros').hide();" />
                    </div>

                    <!-- Horario del maestro (se actualiza automáticamente al seleccionar uno) -->
                    <p:panel header="HORARIO DEL MAESTRO SELECCIONADO" style="margin-top:15px;">

                        <!-- CONTENEDOR CON SCROLL VERTICAL -->
                        <div style="max-height:200px; overflow-y:auto;">

                            <p:dataTable value="#{asignacionMGBean.listaHorarioCrearMaestros}"
                                         var="hm"
                                         id="tablaHorariosMaestro"
                                         styleClass="tabla-horarios"
                                         style="width:100%;"
                                         rowKey="#{hm.id}">

                                <p:column headerText="CLAVE" style="width:6%;">#{hm.materia}</p:column>

                                <p:column headerText="ASIGNATURA" style="width:28%; line-height:1.2;">
                                    <div class="asignatura-box linea-divisora">
                                        <span class="materia">#{hm.asignatura}</span>
                                        <div class="linea"></div>
                                        <span class="maestro">#{hm.docente}</span>
                                    </div>
                                </p:column>

                                <p:column headerText="GRUPO" style="width:6%;">#{hm.grupo}</p:column>

                                <p:column headerText="LUNES" style="width:8%;">#{hm.lunes}</p:column>
                                <p:column headerText="MARTES" style="width:8%;">#{hm.martes}</p:column>
                                <p:column headerText="MIERCOLES" style="width:8%;">#{hm.miercoles}</p:column>
                                <p:column headerText="JUEVES" style="width:8%;">#{hm.jueves}</p:column>
                                <p:column headerText="VIERNES" style="width:8%;">#{hm.viernes}</p:column>
                                <p:column headerText="SABADO" style="width:8%;">#{hm.sabado}</p:column>

                            </p:dataTable>

                        </div>
                    </p:panel>


                </p:dialog>
                <h:outputScript>
                    window.onbeforeunload = function(event) {
                    return "Si recargas la página, los datos del formulario se perderán.";
                    };
                </h:outputScript>

            </h:form>


        </ui:define>

    </ui:composition>

</html>

